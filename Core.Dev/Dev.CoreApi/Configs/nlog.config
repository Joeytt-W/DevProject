<?xml version="1.0" encoding="utf-8"?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <!--具体配置可参考官方示例：https://github.com/jkowalski/NLog/tree/master/examples/targets/Configuration%20File -->
    <targets async="true">
        <!--将日志输出到控制台-->
        <target name="console" type="Console"
                layout="${longdate}|${callsite}|${uppercase:${level}}|${message}"/>
        <!--将日志输出到文件-->
        <target name="file" xsi:type="File"
                fileName="${basedir}/Logs/${shortdate}/${level}.log"
                layout=" 发生时间：${longdate}${newline}
日志级别：${uppercase:${level}}${newline}
操作账号：${event-context:item=Account}${newline}
操作者IP：${event-context:item=IP}${newline}
IP归属地：${event-context:item=IPAddress}${newline}
浏 览 器：${event-context:item=Browser}${newline}
操作模块：${event-context:item=Operation}${newline}
提示信息：${message}${newline}"/>
        <!--将日志输出到邮箱-->
        <target name="mail" xsi:type="Mail"
                smtpServer="smtp.163.com"
                smtpPort="25"
                smtpAuthentication="Basic"
                smtpUserName="elight_mvc"
                smtpPassword="gaoyang1112"
                enableSsl="true"
                addNewLines="true"
                from="elight_mvc@163.com"
                to="973095739@qq.com"
                subject="[Elight.MVC]系统日志报告"
                body=" 发生时间：${longdate}${newline}
日志级别：${uppercase:${level}}${newline}
操作用户：${event-context:item=Account}${newline}
操作者IP：${event-context:item=IP}${newline}
IP归属地：${event-context:item=IPAddress}${newline}
浏 览 器：${event-context:item=Browser}${newline}
操作模块：${event-context:item=Operation}${newline}
提示信息：${message}${newline}" />
        <!--将日志输出到数据库-->
        <target name="database" type="Database"
                connectionstring="Data Source=.\SQLEXPRESS;Initial Catalog=db.0;User ID=root;Password=root">
            <commandText>
                insert into Sys_Log(CreateTime, LogLevel, Message, StackTrace, Id, Account, RealName, Operation, IP, IPAddress, Browser)
                values(@CreateTime, @LogLevel, @Message, @StackTrace, @Id, @Account, @RealName, @Operation, @IP, @IPAddress, @Browser);
            </commandText>
            <parameter name="@LogLevel" layout="${uppercase:${level}}" />
            <parameter name="@Message" layout="${message}" />
            <parameter name="@StackTrace" layout="${stacktrace}" />
            <parameter name="@CreateTime" layout="${date}" />
            <parameter name="@Id" layout="${guid}" />
            <parameter name="@Account" layout="${event-context:item=Account}" />
            <parameter name="@RealName" layout="${event-context:item=RealName}" />
            <parameter name="@Operation" layout="${aspnet-mvc-action}" />
            <parameter name="@IP" layout="${aspnet-request-ip}" />
            <parameter name="@IPAddress" layout="${aspnet-request-host} " />
            <parameter name="@Browser" layout="${event-context:item=Browser}" />
        </target>
    </targets>
    <rules>
        <!--<logger name="*" levels="Error,Fatal" writeTo="mail" />-->
        <!--name="Microsoft.*"表示名字以Microsoft开头的日志会匹配到这个规则。并且加一个final="true"，表示这是匹配到的最后一个规则-->
        <logger name="Microsoft.*" minlevel="Trace" writeTo="console" final="true" />
        <logger name="*" level="Error" writeTo="database" />
        <logger name="*" levels="Info,Error" writeTo="file" />
        <logger name="*" level="Debug" writeTo="console" />
    </rules>
</nlog>